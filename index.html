<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The New Invisible College</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --paper-bg: #faf8f2;
            --paper-border: #d4cfc3;
            --ink: #3a3a3a;
            --ink-soft: #615c54;
            --accent: #8c6b45; 
        }

        body {
            margin: 0; padding: 0;
            font-family: "Libre Baskerville", "Times New Roman", serif;
            background: var(--paper-bg); color: var(--ink);
            overflow: hidden; 
        }

        header {
            text-align: center; padding: 1.5rem 0;
            border-bottom: 1px solid var(--paper-border);
            background: var(--paper-bg);
            z-index: 100; position: relative;
        }

        .container {
            display: flex; height: calc(100vh - 100px);
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 350px; border-right: 1px solid var(--paper-border);
            background: #fdfbf6; padding: 20px;
            overflow-y: auto; z-index: 10;
        }

        .sidebar h2 { font-size: 1.3rem; color: var(--accent); margin-top: 0; }
        .relation-box { 
            margin-top: 20px; padding: 12px; 
            border-left: 3px solid var(--accent); 
            background: rgba(140, 107, 69, 0.05);
            font-size: 0.9rem;
        }

        /* Diagram Area */
        .diagram-container {
            flex: 1; position: relative; cursor: grab;
            background-color: #ffffff;
            user-select: none;
            overflow: hidden;
        }

        .diagram-container:active { cursor: grabbing; }
        svg { width: 100%; height: 100%; }

        /* Zoom Controls */
        .zoom-controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 999;
        }
        
        .zoom-btn {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            background: var(--accent);
            color: white;
            border: none;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .zoom-btn:hover {
            background: #6d5234;
            transform: translateY(-2px);
        }

        /* Elements */
        .link { stroke: #d4cfc3; stroke-opacity: 0.5; stroke-width: 1.5; fill: none; transition: 0.3s; }
        .link.active { stroke: var(--accent); stroke-opacity: 1; stroke-width: 2.5; }
        .node circle { fill: white; stroke: var(--accent); stroke-width: 2; transition: 0.3s; }
        .node:hover circle { fill: #fff5e6; r: 15; }
        .node-text { font-size: 11px; fill: var(--ink); pointer-events: none; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 1.8rem; font-weight: 600;">The New Invisible College</div>
    <div style="font-size: 0.8rem; letter-spacing: 2px; color: var(--ink-soft);">A GENEALOGY OF MODERN PHYSICS</div>
</header>

<div class="container">
    <aside class="sidebar" id="sidebar">
        <div id="intro">
            <h2>Notes</h2>
            <p style="font-size: 0.9rem; color: var(--ink-soft);">Click on a scientist to reveal their connections. Drag the background to pan, or use the buttons to zoom.</p>
        </div>
        <div id="details" style="display:none;">
            <h2 id="s-name">Scientist</h2>
            <p id="s-bio" style="font-size: 0.95rem; line-height: 1.6;"></p>
            <hr style="border: 0; border-top: 1px solid var(--paper-border); margin: 20px 0;">
            <div id="s-links"></div>
        </div>
    </aside>

    <main class="diagram-container" id="canvas">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="manualZoom(1.25)">＋</button>
            <button class="zoom-btn" onclick="manualZoom(0.8)">－</button>
        </div>

        <svg id="scene">
            <g id="main-group"></g>
        </svg>
    </main>
</div>

<script>
/* --- 数据配置 --- */
const groups = {
    "stat":    { x: 500, y: 50,  label: "Statistical Physics" },
    "atomic":  { x: 750, y: 150, label: "Atomic Model" },
    "rel":     { x: 250, y: 200, label: "Relativity & Atomic Theory" },
    "qm":      { x: 550, y: 350, label: "Quantum Mechanics" },
    "condensed":{ x: 950, y: 400, label: "Condensed Matter" },
    "nuclear": { x: 250, y: 500, label: "Nuclear Physics" },
    "astro":   { x: 800, y: 550, label: "Astrophysics" },
    "field":   { x: 550, y: 700, label: "Quantum Field Theory" }
};

const nodes = [
    { id: "boltzmann", label: "L. Boltzmann", group: "stat", bio: "统计力学之父。引入 $S = k \\ln W$。" },
    { id: "maxwell", label: "J. C. Maxwell", group: "stat", bio: "建立电磁场理论与分子速率分布律。" },
    { id: "ehrenfest", label: "P. Ehrenfest", group: "stat", bio: "统计物理的传人，波尔的好友。" },
    { id: "gibbs", label: "J. W. Gibbs", group: "stat", bio: "奠定了化学热力学基础。" },
    { id: "thomson", label: "J.J. Thomson", group: "atomic", bio: "发现电子。" },
    { id: "rutherford", label: "E. Rutherford", group: "atomic", bio: "核物理之父。发现原子核。" },
    { id: "bohr", label: "N. Bohr", group: "atomic", bio: "提出量子化轨道原子模型。" },
    { id: "planck", label: "M. Planck", group: "qm", bio: "发现普朗克常数 $h$。" },
    { id: "einstein", label: "A. Einstein", group: "rel", bio: "相对论创立者。" },
    { id: "heisenberg", label: "W. Heisenberg", group: "qm", bio: "不确定性原理。" },
    { id: "schrodinger", label: "E. Schrodinger", group: "qm", bio: "波动力学创立者。" },
    { id: "dirac", label: "P. Dirac", group: "qm", bio: "狄拉克方程。" },
    { id: "yang", label: "C.N. Yang (杨振宁)", group: "field", bio: "杨-米尔斯场论。" },
    { id: "feynman", label: "R. Feynman", group: "field", bio: "量子电动力学大师。" }
];

const links = [
    { from: "boltzmann", to: "planck", note: "普朗克借用了玻尔兹曼的统计方法。" },
    { from: "rutherford", to: "bohr", note: "师徒关系。" },
    { from: "bohr", to: "heisenberg", note: "共同构建了哥本哈根诠释。" }
];

/* --- 初始化与布局 --- */
const mainGroup = document.getElementById('main-group');
const svg = document.getElementById('scene');

nodes.forEach((node, i) => {
    const gCfg = groups[node.group];
    node.x = gCfg.x + (i % 3) * 120;
    node.y = gCfg.y + Math.floor(i / 3) * 100;
});

links.forEach(link => {
    const s = nodes.find(n => n.id === link.from);
    const t = nodes.find(n => n.id === link.to);
    if (!s || !t) return;
    const lEl = document.createElementNS("http://www.w3.org/2000/svg", "line");
    lEl.setAttribute("class", `link l-${link.from} l-${link.to}`);
    lEl.setAttribute("x1", s.x); lEl.setAttribute("y1", s.y);
    lEl.setAttribute("x2", t.x); lEl.setAttribute("y2", t.y);
    mainGroup.appendChild(lEl);
});

nodes.forEach(node => {
    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
    g.setAttribute("class", "node");
    const circ = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    circ.setAttribute("cx", node.x); circ.setAttribute("cy", node.y); circ.setAttribute("r", 10);
    const txt = document.createElementNS("http://www.w3.org/2000/svg", "text");
    txt.setAttribute("x", node.x); txt.setAttribute("y", node.y + 25);
    txt.setAttribute("text-anchor", "middle"); txt.setAttribute("class", "node-text");
    txt.textContent = node.label;
    g.appendChild(circ); g.appendChild(txt);
    g.onclick = (e) => { e.stopPropagation(); clickNode(node); };
    mainGroup.appendChild(g);
});

/* --- 交互控制 --- */
let scale = 1, tx = 0, ty = 0;
let isDragging = false, startX, startY;

const updateTransform = () => {
    mainGroup.setAttribute("transform", `translate(${tx},${ty}) scale(${scale})`);
};

function manualZoom(factor) {
    const oldScale = scale;
    scale *= factor;
    scale = Math.min(Math.max(scale, 0.2), 4); // 限制范围

    const rect = svg.getBoundingClientRect();
    const cx = rect.width / 2;
    const cy = rect.height / 2;
    
    tx = cx - (cx - tx) * (scale / oldScale);
    ty = cy - (cy - ty) * (scale / oldScale);
    updateTransform();
}

svg.onmousedown = (e) => {
    if(e.button !== 0) return;
    isDragging = true;
    startX = e.clientX - tx;
    startY = e.clientY - ty;
};

window.onmousemove = (e) => {
    if (!isDragging) return;
    tx = e.clientX - startX;
    ty = e.clientY - startY;
    updateTransform();
};

window.onmouseup = () => isDragging = false;

// 降低滚轮灵敏度
svg.onwheel = (e) => {
    e.preventDefault();
    const oldScale = scale;
    const delta = e.deltaY > 0 ? 0.96 : 1.04; // 极其微小的缩放
    scale *= delta;
    scale = Math.min(Math.max(scale, 0.2), 4);

    const rect = svg.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    tx = mouseX - (mouseX - tx) * (scale / oldScale);
    ty = mouseY - (mouseY - ty) * (scale / oldScale);
    updateTransform();
};

function clickNode(node) {
    document.getElementById('intro').style.display = 'none';
    const det = document.getElementById('details');
    det.style.display = 'block';
    document.getElementById('s-name').textContent = node.label;
    document.getElementById('s-bio').innerHTML = node.bio;
    document.querySelectorAll('.link').forEach(l => l.classList.remove('active'));
    document.querySelectorAll(`.l-${node.id}`).forEach(l => l.classList.add('active'));
    MathJax.typeset();
}
</script>
</body>
</html>
